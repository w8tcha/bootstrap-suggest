!function(a){"use strict";function h(t,e,i){this.$element=a(t),this.$items=void 0,this.options=a.extend(!0,{},a.fn.suggest.defaults,i,this.$element.data(),this.$element.data("options")),this.key=e,this.isShown=!1,this.query="",this._queryPos=[],this._keyPos=-1,this.$dropdown=a("<div />",{class:"dropdown suggest "+this.options.dropdownClass,html:a("<div />",{class:"dropdown-menu",role:"menu"}),"data-key":this.key}),this.load()}h.prototype={__setListener:function(){return this.$element.on("suggest.show",a.proxy(this.options.onshow,this)).on("suggest.select",a.proxy(this.options.onselect,this)).on("suggest.lookup",a.proxy(this.options.onlookup,this)).on("keyup",a.proxy(this.__keyup,this)),this},__getCaretPos:function(t){var e,i,s,o,n=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"],r=!(null==window.mozInnerScreenX);return e=this.$element.get(0),t=t,(i=document.createElement("div")).id="input-textarea-caret-position-mirror-div",document.body.appendChild(i),s=i.style,o=window.getComputedStyle?getComputedStyle(e):e.currentStyle,s.whiteSpace="pre-wrap","INPUT"!==e.nodeName&&(s.wordWrap="break-word"),s.position="absolute",s.visibility="hidden",a.each(n,function(t,e){s[e]=o[e]}),r?(s.width=parseInt(o.width)-2+"px",e.scrollHeight>parseInt(o.height)&&(s.overflowY="scroll")):s.overflow="hidden",i.textContent=e.value.substring(0,t),"INPUT"===e.nodeName&&(i.textContent=i.textContent.replace(/\s/g,"Â ")),(n=document.createElement("span")).textContent=e.value.substring(t)||".",i.appendChild(n),e={top:n.offsetTop+parseInt(o.borderTopWidth),left:n.offsetLeft+parseInt(o.borderLeftWidth)},document.body.removeChild(i),e},__keyup:function(t){switch(t.keyCode){case 27:return void this.hide();case 13:return!0}if(-1===a.inArray(t.keyCode,[38,40,37,39,17,18,9,16,20,91,93,36,35,45,33,34,144,112,113,114,115,116,117,118,119,120,121,122,123,145,19]))for(var t=this.$element,e=t.val(),i=this.__getSelection(t.get(0)).start,s=i;0<=s;s--){var o=a.trim(e.substring(s-1,s));if(!o&&this.options.respectWhitespace){this.hide();break}var n=""==a.trim(e.substring(s-2,s-1));if(o===this.key&&(n||!this.options.respectWhitespace)){this.query=e.substring(s,i),this._queryPos=[s,i],this._keyPos=s,this.lookup(this.query);break}}},__getVisibleItems:function(){return this.$items?this.$items.not(".d-none"):a()},__build:function(){function e(t){s.hide()}var t=this.$dropdown,s=this;t.on("click","a.dropdown-item",function(t){t.preventDefault(),s.__select(a(this).index()),s.$element.focus()}).on("mouseover","a.dropdown-item",function(t){s.$element.off("blur",e)}).on("mouseout","a.dropdown-item",function(t){s.$element.on("blur",e)}),this.$element.before(t).on("blur",e).on("keydown",function(t){var i;if(s.isShown)switch(t.keyCode){case 13:case 9:return(i=s.__getVisibleItems()).each(function(t){a(this).is(".active")&&s.__select(a(this).index())}),!1;case 40:return(i=s.__getVisibleItems()).last().is(".active")||i.each(function(t){var e=a(this),t=i.eq(t+1);if(e.is(".active"))return t.is(".d-none")||(e.removeClass("active"),t.addClass("active")),!1}),!1;case 38:return(i=s.__getVisibleItems()).first().is(".active")||i.each(function(t){var e=a(this),t=i.eq(t-1);if(e.is(".active"))return t.is(".d-none")||(e.removeClass("active"),t.addClass("active")),!1}),!1}})},__mapItem:function(t){var e={text:"",value:"",class:""};return!(this.options.map&&!(t=this.options.map(t)))&&(t instanceof Object?(e.text=t.text||"",e.value=t.value||"",e.class=t.class||""):(e.text=t,e.value=t),a("<a />",{class:"dropdown-item "+e.class,"data-value":e.value,href:"#",html:e.text}))},__select:function(t){var e=this.options.endKey||"",i=this.$element,s=i.get(0),o=i.val(),t=this.get(t),n=this._keyPos+t.value.length+1;i.val(o.slice(0,this._keyPos)+t.value+e+" "+o.slice(this.__getSelection(s).start)),i.blur(),s.setSelectionRange?s.setSelectionRange(n,n):s.createTextRange&&((e=s.createTextRange()).collapse(!0),e.moveEnd("character",n),e.moveStart("character",n),e.select()),i.trigger(a.extend({type:"suggest.select"},this),t),this.hide()},__getSelection:function(t){return t.focus(),{start:t.selectionStart,end:t.selectionEnd}},__buildItems:function(t){var e=this.$dropdown.find(".dropdown-menu");if(e.empty(),t&&t instanceof Array)for(var i in t){i=this.__mapItem(t[i]);i&&e.append(i)}return e.find("a.dropdown-item")},__lookup:function(t,e){e.eq(0).addClass("active");this.$element.trigger(a.extend({type:"suggest.lookup"},this),[t,e]),e&&e.length?this.show():this.hide()},__filterData:function(i,t){var s=this.options;return this.$items.addClass("d-none"),this.$items.filter(function(t){var e;return""===i?t<s.filter.limit:(t=a(this).text(),e=a(this).data().value,s.filter.casesensitive||(t=t.toLowerCase(),i=i.toLowerCase(),e=e.toLowerCase()),-1!=t.indexOf(i)||-1!=e.indexOf(i))}).slice(0,s.filter.limit).removeClass("d-none active"),this.__getVisibleItems()},get:function(t){var e;if(this.$items)return{text:(e=this.$items.eq(t)).text(),value:e.attr("data-value"),index:t,$element:e}},lookup:function(e){this.options;function t(t){-1!==i._keyPos&&(i.$items||(i.$items=i.__buildItems(t)),i.__lookup(e,i.__filterData(e,t)))}var i=this,s="function"==typeof this.options.data?(this.$items=void 0,this.options.data(e,t)):this.options.data;s&&"function"==typeof s.promise?s.done(t):s&&t.call(this,s)},load:function(){this.__setListener(),this.__build()},hide:function(){this.$dropdown.find(".dropdown-menu").removeClass("show"),this.isShown=!1,this.$items&&this.$items.removeClass("active"),this._keyPos=-1},show:function(){var t,e=this.$element,i=this.$dropdown.find(".dropdown-menu"),s=e.get(0),o=this.options,n={top:"auto",bottom:"auto",left:"auto",right:"auto"};if(!this.isShown){if(i.addClass("show"),!1!==o.position){if(t=this.__getCaretPos(this._keyPos),"string"==typeof o.position)switch(o.position){case"bottom":n.top=e.outerHeight()-parseFloat(i.css("margin-top")),n.left=0,n.right=0;break;case"top":n.top=-(i.outerHeight(!0)+parseFloat(i.css("margin-top"))),n.left=0,n.right=0;break;case"caret":n.top=t.top-s.scrollTop,n.left=t.left-s.scrollLeft}else n=a.extend(n,"function"==typeof o.position?o.position(s,t):o.position);i.css(n)}this.isShown=!0,e.trigger(a.extend({type:"suggest.show"},this))}}};var t=a.fn.suggest;a.fn.suggest=function(e){function o(i,t){var s={};return a.each(t,function(t,e){t=t.toString().charAt(0);s[t]=new h(i,t,"object"==typeof e&&e)}),s}var n=arguments[1],r=arguments[2];return this.each(function(){var t=a(this),i=t.data("suggest"),s={};if("string"==typeof e)if(1==e.length){if(n)if("string"==typeof n){if(e in i&&void 0!==i[e][n])return i[e][n].call(i[e],r);console.error(e+" is not a suggest")}else s[e]=a.isArray(n)||"function"==typeof n?{data:n}:n,i&&e in i?i[e].options=a.extend({},i[e].options,s[e]):i=a.extend(i,o(this,s)),t.data("suggest",i)}else console.error("you're not initializing suggest properly. arg1 should have length == 1");else i?(a.each(e,function(t,e){t in i==!1?s[t]=e:i[t].options=a.extend({},i[t].options,e)}),t.data("suggest",a.extend(i,o(this,s)))):t.data("suggest",o(this,e))})},a.fn.suggest.defaults={data:[],map:void 0,filter:{casesensitive:!1,limit:5},dropdownClass:"",position:"caret",endKey:"",respectWhitespace:!0,onshow:function(t){},onselect:function(t,e){},onlookup:function(t,e){}},a.fn.suggest.Constructor=h,a.fn.suggest.noConflict=function(){return a.fn.suggest=t,this}}(jQuery);